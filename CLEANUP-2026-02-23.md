# Directory Structure Cleanup - Feb 23, 2026

## What Was Cleaned Up

Removed old service-level overlay directories that were causing confusion:
- ❌ `kubernetes/overlays/homelab/catalogue/` (DELETED)
- ❌ `kubernetes/overlays/homelab/frontend/` (DELETED)
- ❌ `kubernetes/overlays/homelab/voting/` (DELETED)
- ❌ `kubernetes/overlays/homelab/recommendation/` (DELETED)

## What Was Kept

- ✅ `kubernetes/overlays/homelab/deps/` - Shared dependencies overlay
- ✅ `kubernetes/overlays/homelab/dev/` - Dev environment
- ✅ `kubernetes/overlays/homelab/staging/` - Staging environment
- ✅ `kubernetes/overlays/homelab/prod/` - Production environment

## Why This Was Done

The repository had **two conflicting structures**:

### Old Structure (Removed)
```
overlays/homelab/
├── catalogue/      ← Service-first (CONFUSING)
├── frontend/
├── voting/
└── recommendation/
```

### New Structure (Current)
```
overlays/homelab/
├── dev/            ← Environment-first (CLEAR)
│   ├── catalogue/
│   ├── frontend/
│   ├── voting/
│   └── recommendation/
├── staging/
│   └── ...
└── prod/
    └── ...
```

## What Was Fixed

### ArgoCD Applications Updated

Fixed all dev ArgoCD applications to point to correct paths:

**Before:**
```yaml
path: kubernetes/overlays/homelab/catalogue
```

**After:**
```yaml
path: kubernetes/overlays/homelab/dev/catalogue
```

Files updated:
- `argocd/applications/clusters/homelab/dev/catalogue-app.yaml`
- `argocd/applications/clusters/homelab/dev/frontend-app.yaml`
- `argocd/applications/clusters/homelab/dev/voting-app.yaml`
- `argocd/applications/clusters/homelab/dev/recommendation-app.yaml`

## Current Correct Structure

```
kubernetes/overlays/homelab/
├── deps/                    # Shared dependencies (MongoDB, PostgreSQL, Redis)
│   └── kustomization.yaml
├── dev/                     # Development environment
│   ├── namespace.yaml
│   ├── vault-ca.yaml
│   ├── kustomization.yaml
│   ├── catalogue/
│   │   ├── kustomization.yaml
│   │   ├── deployment-patch.yaml
│   │   ├── configmap-patch.yaml
│   │   ├── ingress-patch.yaml
│   │   └── resources-patch.yaml
│   ├── frontend/
│   ├── voting/
│   └── recommendation/
├── staging/                 # Staging environment
│   ├── namespace.yaml
│   ├── vault-ca.yaml
│   ├── kustomization.yaml
│   ├── deps/
│   ├── catalogue/
│   ├── frontend/
│   ├── voting/
│   └── recommendation/
└── prod/                    # Production environment
    └── ... (same structure)
```

## Benefits

1. **Clear hierarchy**: Environment → Service (not Service → Environment)
2. **No confusion**: Only one way to organize overlays
3. **Scalable**: Easy to add new environments
4. **Consistent**: Matches industry best practices

## Note on Deployment Guide

The file `04-phase-2-homelab-full-stack-step-by-step.md` contains outdated paths referencing the old structure. This guide was written before the environment-first restructuring. 

**Current users should follow the environment-first structure** as documented in:
- `STAGING-QUICKSTART.md`
- `kubernetes/overlays/homelab/staging/README.md`
- `ENVIRONMENTS.md`

## Migration Impact

✅ **No impact on running deployments** - ArgoCD apps were updated before deletion
✅ **All references verified** - Searched entire repo for references
✅ **Documentation updated** - This file documents the change

## Verification

After cleanup, verify structure:
```bash
tree kubernetes/overlays/homelab -L 2
```

Expected output:
```
kubernetes/overlays/homelab
├── deps
│   └── kustomization.yaml
├── dev
│   ├── catalogue
│   ├── frontend
│   ├── voting
│   ├── recommendation
│   ├── namespace.yaml
│   ├── vault-ca.yaml
│   └── kustomization.yaml
├── staging
│   └── ... (similar structure)
└── prod
    └── ... (similar structure)
```
